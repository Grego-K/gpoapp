<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaGPO - ÎšÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ Î ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col font-sans">

<div th:replace="~{fragments/layout :: header}"></div>

<main class="max-w-[1600px] mx-auto px-4 py-6 w-full flex-1">
    <div class="flex flex-col lg:flex-row gap-6 items-start">

        <div class="w-full lg:w-3/4 flex flex-col gap-6">

            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <h1 class="text-2xl font-bold text-gray-800 mb-4">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î ÏÎ¿ÏŠÏŒÎ½Ï„Î± GPO</h1>
                <form method="get" th:action="@{/products}" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <input type="text" name="name" th:value="${param.name}" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·..." class="w-full px-3 py-2 rounded-lg border border-gray-200 outline-none text-sm">
                    <select name="categoryId" class="w-full px-3 py-2 rounded-lg border border-gray-200 outline-none text-sm">
                        <option value="">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</option>
                        <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
                    </select>
                    <button type="submit" class="py-2 bg-teal-600 text-white rounded-lg font-bold hover:bg-teal-700 text-sm shadow-sm transition-all">Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±</button>
                </form>
            </div>

            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b border-gray-200 text-[11px] font-bold text-gray-400 uppercase tracking-wider">
                    <tr>
                        <th class="px-6 py-4">Î ÏÎ¿ÏŠÏŒÎ½</th>
                        <th class="px-6 py-4 text-right">Î¤Î¹Î¼Î® GPO</th>
                        <th class="px-6 py-4 text-center">Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                    <tr th:each="product : ${products}" class="hover:bg-gray-50/80 transition-colors">
                        <td class="px-6 py-4">
                            <div class="font-bold text-gray-800 text-sm" th:text="${product.productName}">Product</div>
                            <div class="text-[10px] text-gray-400 font-bold uppercase tracking-tight" th:text="${product.supplier.companyName}">Supplier</div>
                        </td>
                        <td class="px-6 py-4 text-right font-bold text-teal-600 text-sm" th:text="${#numbers.formatDecimal(product.gpoPrice, 1, 2) + ' â‚¬'}">0.00 â‚¬</td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex items-center justify-center gap-2">
                                <input type="number" value="1" min="1" th:id="'qty-' + ${product.id}" class="w-14 px-2 py-1 rounded-md border border-gray-200 text-sm outline-none focus:ring-1 focus:ring-teal-500">
                                <button type="button" th:onclick="addToTempList([[${product.id}]], [[${product.productName}]], [[${product.gpoPrice}]])" class="p-1.5 bg-teal-600 text-white rounded-md hover:bg-teal-700 transition-all shadow-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div th:if="${products instanceof T(org.springframework.data.domain.Page) and products.totalPages > 1}" class="flex justify-center gap-2 py-6">
                <a th:each="i : ${#numbers.sequence(0, products.totalPages - 1)}"
                   th:href="@{/products(page=${i}, name=${param.name}, categoryId=${param.categoryId})}"
                   th:text="${i + 1}"
                   th:class="${products.number == i} ? 'px-4 py-2 bg-teal-600 text-white rounded-lg font-bold shadow-md' : 'px-4 py-2 bg-white text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 text-sm font-medium transition-all'">
                </a>
            </div>
        </div>

        <aside class="w-full lg:w-1/4">
            <div class="sticky top-6 bg-white rounded-xl border border-teal-200 flex flex-col min-h-[400px] max-h-[85vh] shadow-sm">
                <div class="p-5 border-b border-teal-50 bg-teal-50/30 rounded-t-xl">
                    <h2 class="text-sm font-bold text-gray-700 uppercase tracking-widest flex items-center gap-2">
                        ğŸ›’ Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î›Î¯ÏƒÏ„Î±
                    </h2>
                </div>

                <div id="temp-cart-items" class="flex-1 overflow-y-auto p-5 space-y-3 custom-scrollbar">
                    <p class="text-gray-400 text-sm text-center py-10 italic">Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ ÎµÎ¯Î´Î·</p>
                </div>

                <div class="p-5 bg-gray-50/50 rounded-b-xl border-t border-gray-100">
                    <div class="flex justify-between items-center mb-5">
                        <span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Î£ÏÎ½Î¿Î»Î¿:</span>
                        <span id="temp-total-price" class="text-teal-600 text-xl font-black">0.00 â‚¬</span>
                    </div>
                    <form th:action="@{/pharmacist/orders/add-bulk}" method="post">
                        <input type="hidden" name="itemsJson" id="itemsJson">
                        <button type="submit" id="submit-bulk-btn" disabled
                                class="w-full py-4 bg-teal-600 text-white rounded-xl font-bold hover:bg-teal-700 transition-all disabled:bg-gray-300 shadow-lg disabled:shadow-none text-xs uppercase tracking-widest">
                            ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÎœÎ±Î¶Î¹ÎºÎ¬
                        </button>
                    </form>
                </div>
            </div>
        </aside>

    </div>
</main>

<div th:replace="~{fragments/layout :: footer}"></div>

<script>
    let selectedItems = [];
    function addToTempList(id, name, price) {
        const qty = parseInt(document.getElementById('qty-' + id).value);
        if (qty <= 0 || isNaN(qty)) return;
        const existing = selectedItems.find(item => item.productId === id);
        if (existing) { existing.quantity += qty; }
        else { selectedItems.push({ productId: id, productName: name, unitPrice: price, quantity: qty }); }
        renderTempCart();
    }
    function removeItem(id) {
        selectedItems = selectedItems.filter(item => item.productId !== id);
        renderTempCart();
    }
    function renderTempCart() {
        const container = document.getElementById('temp-cart-items');
        const totalEl = document.getElementById('temp-total-price');
        const btn = document.getElementById('submit-bulk-btn');
        const jsonIn = document.getElementById('itemsJson');
        if (selectedItems.length === 0) {
            container.innerHTML = '<p class="text-gray-400 text-sm text-center py-10 italic">Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ ÎµÎ¯Î´Î·</p>';
            totalEl.innerText = "0.00 â‚¬"; btn.disabled = true; jsonIn.value = ""; return;
        }
        let total = 0;
        container.innerHTML = selectedItems.map(item => {
            total += (item.unitPrice * item.quantity);
            return `
                <div class="bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center hover:border-teal-200 transition-all shadow-sm">
                    <div class="text-left overflow-hidden mr-2">
                        <div class="text-sm font-bold text-gray-800 leading-tight">${item.productName}</div>
                        <div class="text-xs text-gray-500 font-medium mt-1">${item.quantity} Ï„Î¼Ï‡ x ${item.unitPrice.toFixed(2)}â‚¬</div>
                    </div>
                    <button type="button" onclick="removeItem(${item.productId})" class="text-red-300 hover:text-red-500 font-bold text-xl leading-none ml-2 transition-colors">&times;</button>
                </div>`;
        }).join('');
        totalEl.innerText = total.toFixed(2) + " â‚¬"; btn.disabled = false;
        jsonIn.value = JSON.stringify(selectedItems);
    }
</script>
</body>
</html>